stages:
  - build
  - test
  - triggers

pytest:
  stage: test
  trigger:
    include: CameraProcessor/.gitlab-ci.yml
  rules:
    - changes:
        - CameraProcessor/*
#
#trigger_orchestrator:
#  stage: triggers
#  trigger:
#    include: ProcessorOrchestrator/.gitlab-ci.yml
#  rules:
#    - if: $CI_MERGE_REQUEST_ID
#    - changes:
#        - ProcessorOrchestrator/*

orchestrator_docker_build:
  stage: build
  script:
    - cd ProcessorOrchestrator
    - docker build -t processor-orchestrator --target testing ./ProcessorOrchestrator
  rules:
    - if: $CI_MERGE_REQUEST_ID
    - changes:
        - ProcessorOrchestrator/*

orchestrator_unit-testing:
  stage: test
  needs: [orchestrator_docker_build]
  script:
    - cd ProcessorOrchestrator
    - docker run processor-orchestrator
  rules:
    - if: $CI_MERGE_REQUEST_ID
    - changes:
        - ProcessorOrchestrator/*